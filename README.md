# AI剧本工坊

## 1.系统主控模块
### 控制剧本工坊的主运行流程，包括角色初始化、剧情流程推进与用户交互驱动。

### main.py
#### 系统入口，加载人物设定，初始化角色会话，注册剧情流程控制器，启动主事件循环

### director.py
#### 剧本导演模块，维护当前剧情阶段、冲突状态、转折点、角色情绪调度等全局信息，并协调各角色生成逻辑

## 2.角色上下文和人格设定模块
### 定义角色的行为语义属性、初始上下文设定、情绪状态与行为风格参数。

### actors/character_config.py
#### 存储角色的基本属性（名称、背景、语调、逻辑边界等），以结构化形式管理

### actors/context_manager.py
#### 基于MCP封装每个角色的上下文链，支持Prompt注入、状态更新与角色视角管理

## 3.Prompt模板与情绪槽位模板
### 定于用于角色生成内容的Prompt结构与动态插槽，如当前情绪、剧情目标、上下文摘要等。

### prompts/character_prompt_templates.py
#### 角色专属Prompt模板、含槽位支持、内容结构化定义

### prompts/emotion_map.py
#### 情绪状态与语言控制映射表，用于注入不同情绪下的语义风格

### prompts/story_templates.py
#### 用作系统级剧情进展、背景叙述等描述的Prompt块。

## 4.剧情流程控制模块
### 根据故事阶段控制角色行为方式与交互形式，决定剧情转折条件与推进方式

### story/story_state.py
#### 定义剧情阶段状态与状态迁移逻辑

### story/trigger_rules.py
#### 定义剧情事件触发器，如某角色达到怒气阈值后引发剧情冲突。

## 5.角色响应生成与多轮协同模块
### 将角色的上下文、当前情绪与剧情状态结合，生成语义合理、行为一致的台词

### engine/generator.py
#### 调用deepseek-chat模型，结合MCP上下文生成角色输出

### engine/response_coordiantor.py 
#### 控制多个角色响应的顺序、回合同步与冲突解决机制

### engine/emotion_updater.py 
#### 根据对话内容与触发规则更新角色当前情绪状态

## 6.用户输入与交互分支模块
### 支持用户动态介入剧情，如选择剧情走向、插入设定、重设角色情绪等。

### user_input/branch_controller.py
#### 解析用户输入的剧情选择项，并同步修改全局变量

### user_input/direct_edit.py
#### 提供开发者接口，用于即使修改角色属性或剧情变量

## 7.调试、记录与回放模块
### 记录每一轮交互、情绪变化与剧情流转，并支持历史回溯、版本复原与调试控制
### debug/logging.py
#### 记录上下文状态变化、生成响应、分支决策等

### debug/inspector.py
#### 提供命令行调试接口，可查看任意角色当前状态或上下文内容

### debug/snapshot.py
#### 存储全局快照，用户回溯与版本重演

